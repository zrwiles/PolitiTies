<!DOCTYPE html>
<!Index Firebase >

<html>
 <!-- Firebase stuff -->
    <script defer src='/__/firebase/7.2.2/firebase-app.js'></script>
    <!-- include only the Firebase features as you need -->
    <script defer src='/__/firebase/7.2.2/firebase-auth.js'></script>
    <script defer src='/__/firebase/7.2.2/firebase-database.js'></script>
    <script defer src='/__/firebase/7.2.2/firebase-messaging.js'></script>
    <!--<script defer src="/__/firebase/7.1.0/firebase-storage.js"></script>-->
    <!-- initialize the SDK after all desired features are loaded -->
    <script defer src='/__/firebase/7.2.2/firebase-firestore.js'></script>
    <script defer src='/__/firebase/init.js'></script>
    
<!---html actually begins--->  
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="profilecss.css">

    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>
</head>

<body>
    
 <div class="card" style="width:33%"> </div>
            <div class="container">
                <form class="form-inline active-cyan-4" style="float:right">
            <input class="form-control form-control-sm mr-3 w-90" type="text" placeholder="Search"
                aria-label="Search">
                    <i class="fas fa-search" aria-hidden="true"></i>
                </form>
    
                
                <div class="top-right" id="Title"></div>
            </div>


    <!-- jQuery CDN - Slim version (=without AJAX) -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <div class="wrapper">
        <!-- Sidebar -->
        <nav id="sidebar">
        <div class="sidebar-header">
            <h3>PolitiTies</h3>
        </div>

        <ul class="list-unstyled components">
            
            <li class="active">
                
            <a id ="profile" href='profile.html?id="+doc.id+"'> Profile</a>
            </li>
            <li>
                <a href="#">Wellesley</a>
            </li>
            <li>
                <a href="feed.html">Feed</a>
            </li>
            <li>
                <a href="#">Updates</a>
            </li>
            
           
            <li>
                <a href="#">Direct Messages</a>
            </li>
            <li>
                <a id="newpost" href="newEvent.html">New post</a>
            </li>
        </ul>
     <a id="signOut" href="index.html" onclick="signOut();">Sign out</a>
    </nav>
<div class="container">
	<div class="row">
		<div class="col-lg-12 col-sm-8">
             <button id="follow" style="float:right" type="button" class="btn btn-outline-secondary" onclick="addTie();">add</button>
            <div class="card hovercard">
                
                <div class="cardheader">
                    
                    <img id= "picURL" alt="profile-pic" src="blank.png" class="insideAvatar" />
                </div>
              
                    
              <nav id="bio">
                <div class="info">
                    <div class="title">
                        <p id= "name" >Name</p>
                    </div>
                    <div class="desc">
                        <p id= "school" >School</p>
                    
                    </div>
                    <div class="desc">
                        <p id= "txt-bio" >Bio</p>
                    </div>
                  
                </div>
                </nav>
                <nav>
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        
                        <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">Ties</a>
                        <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false">Posts</a>
                </div>
                </nav>
                <div class="tab-content" id="nav-tabContent">
                    
                    <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                         <div class="card" id="completeFL">
                           
                        </div>  
                        <frameset rows="25%,*,25%">
                                    <frame src="frame_a.htm">
                                    <frame src="frame_a.htm">
                                    
                        </frameset>

                    </div>
                    <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
                            <div class="card" id="postList">
                            
                        </div>  
                         <frameset rows="25%,*,25%">
                                    <frame src="frame_a.htm">
                                    <frame src="frame_a.htm">
                                    
                        </frameset>
                    
                    </div>
                </div>
            </div>

        </div>

	</div>
</div>
</div>
  
    
</body>
    


 <!-- Function -->
<script>
        document.addEventListener('DOMContentLoaded', function() {
       
        // // The Firebase SDK is initialized and available here!
        //
        firebase.auth().onAuthStateChanged(authStateObserver);
        //intializeApp();
        
        // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
        // firebase.messaging().requestPermission().then(() => { });
        // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
        // spliting current page url at = sign making into an array and elt 1 of array is after the = sign 
        
            
        
     

        try {
          let app = firebase.app();
          let features = ['auth', 'database', 'messaging', 'storage'].filter(feature => typeof app[feature] === 'function');
          
        } catch (e) {
          console.error(e);
          
        }
      });
      function signIn() {
         var provider = new firebase.auth.GoogleAuthProvider();
         firebase.auth().signInWithPopup(provider);
         //window.location = "feed.html";
      }
    
      
     function intializeApp(){
         
     //get the HTML element where you want to print the name
           //var name = document.getElementById("name"); 
       //    var db = firebase.firestore();
        //   db.collection("...").doc("...").onSnapshot(function(document) {
      //    name.innerHTML = document.data().name;
       //  });
     }
    function addTie(){
        var vals = window.location.search.split("=");
        var db = firebase.firestore();
        var name, bio, school, username, friends; 
        var currentUser = firebase.auth().currentUser.uid;
        // if not on users page 
        if (currentUser != vals[1]){
         // create an empty friends arr
    
            // get info from current list of friends 
            
            db.collection("user").doc(currentUser).onSnapshot(function (doc) {
                friends = doc.data().friends;
                name = doc.data().Name;
                bio = doc.data().bio;
                school = doc.data().school;
                username = doc.data().username; 
                
                if (friends.includes(vals[1]) == false){
                friends.push(vals[1]);
               
                
                db.collection("user").doc(currentUser).set({
                      Name: name,
                      friends: friends,
                      bio: bio,
                      school: school, 
                      username: username,
            
                }); 
                 }
          });   
        }
    }
    

      function authStateObserver(user) {
        
        if (user) { 
            console.log("user signed in");// User is signed in!
            goToProfile();
            getUsername();
            createFriendsList();
            createPostsList();
    //        document.getElementById("sign-in").hidden = true;
    //        document.getElementById("sign-out").hidden = false;
        } else { 
            console.log("nope");
            // User is signed out!
     //       document.getElementById("sign-in").hidden = false;
    //        document.getElementById("sign-out").hidden = true;
        }}

    
    
    ///end of transplant 
    function signOut(){
     firebase.auth().signOut();
    }
  
    function goToProfile(){
         var profileLink = firebase.auth().currentUser.uid;
         var prof = document.getElementById("profile");
         prof.setAttribute("href", "profile.html?id=" + profileLink);
     }
    
    function getUsername(){
      //   var profileLink = firebase.auth().currentUser.uid;
      // var name = document.getElementById("name")
    //   name.innerHTML = firebase.auth().currentUser.displayName;
   //    name.setAttribute("href", "profile.html?id=" + profileLink);
        
        var vals = window.location.search.split("=");
        
        var db = firebase.firestore();
       
        db.collection("user").doc(vals[1]).onSnapshot(function (doc) {
        document.getElementById("name").innerHTML = doc.data().Name;
        document.getElementById("school").innerHTML = doc.data().school;
        document.getElementById("txt-bio").innerHTML = doc.data().bio;
     });



        
        
        //console.log(db.collection("user").doc(vals[1]));
      //  db.collection("user").doc(vals[1]).onSnapshot(function (doc) {
      //      document.getElementById("name").innerHTML = doc.data().Name;
     //       document.getElementById("school").innerHTML = doc.data().school;
     //       });
      
     //   var name = document.getElementById("Name");
      //  name.innerHTML = firebase.auth().currentUser.displayName; 
    }
    function createPostsList(){
        var posts = document.getElementById("postList");
        posts.innerHTML = "";
        var db = firebase.firestore();
        var vals = window.location.search.split("=");
        db.collection("user").doc(vals[1]).collection("posts").get().then(function (querySnapshot) {
         querySnapshot.forEach(function(document){
            //As you read each post from the database, add it as
            //a new element to the feed.
            posts.innerHTML = posts.innerHTML +
            "<div style= 'margin-left: 1em;color:#00ba9b;font-size: 1em;' id='name'>" +document.data().title+"</div>"+
            "<div style= 'margin-left: 1em;' id='name'>"+document.data().poster+"</div>"+
             "<div style= 'margin-left: 1em; ' id='uTitle'>"+document.data().text+"</div>"+
             "<p>";
          });
    });
        
    }
    function createFriendsList(){
        var friendsList = document.getElementById("completeFL");
        friendsList.innerHTML = "";
        var db = firebase.firestore();
        var base = firebase.firestore();
        var vals = window.location.search.split("=");
        var friends; 
        
        db.collection("user").doc(vals[1]).onSnapshot(function (doc) {
            friends = doc.data().friends;
            var i;
            for (i = 0; i < friends.length; i++){
                base.collection("user").doc(friends[i]).onSnapshot(function (document) {
                    
                    tmphref = "<a style= 'margin-left: .25em;color:#00ba9b;font-size: 1em;' id='friendName" + i.toString + "'"+ " href='profile.html?id=" + document.data().username + "'>";
                    
                    friendsList.innerHTML = friendsList.innerHTML + tmphref + document.data().Name + "</a>"+ "<p>";
                 });
            
        }
                                                              
        
     });

            
         
    
    }

    </script>
    
  
      

</html>